$("tr:last").after($("<%= escape_javascript(render partial: 'form_section', locals: {selected_column: nil, selected_operator: nil, text: nil})%>"));

var disable_text_fields, set_data_field_type;

disable_text_fields = function(row_obj) {
  if ($(row_obj).val().toLowerCase() === 'all') {
    $(row_obj).parents("tr").find(".data-input-field:visible").attr("disabled", true);
  } else {
    $(row_obj).parents("tr").find(".data-input-field:visible").attr("disabled", false);
  }
  return $(row_obj).parents("tr").find(".data-input-field:hidden").each(function(index) {
    return $(this).attr("disabled", true);
  });
};

set_data_field_type = function(row_obj) {
  var input_field, select_field;
  input_field = $(row_obj).parents("tr").find("input.data-input-field");
  select_field = $(row_obj).parents("tr").find("select.data-input-field");
  switch ($(row_obj).val().toLowerCase()) {
    case 'start_date':
      input_field.attr("type", "date");
      break;
    case 'scheduled_hours_start':
    case 'scheduled_hours_end':
      input_field.attr("type", "time");
      break;
    default:
      input_field.attr("type", "text");
  }
  if ($(row_obj).val().toLowerCase() === 'projects') {
    select_field.removeClass("hidden");
    input_field.addClass("hidden");
  } else {
    select_field.addClass("hidden");
    input_field.removeClass("hidden");
  }
  return disable_text_fields($(row_obj).parents("tr").find(".operator-dropdown"));
};

$(".operator-dropdown").on("change", function() {
  return disable_text_fields(this);
});
$(".glyphicon.glyphicon-remove").on("click", function() {
  return $(this).parents("tr").remove();
});
$(".column-name-dropdown").on("change", function() {
  return set_data_field_type(this);
});